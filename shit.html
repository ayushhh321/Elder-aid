<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volunteer Dashboard - Elderly Assistance Portal</title>
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/volunteer-dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
                                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
                                          /* //removed css for short message */
        .accept-btn {
            background-color: #4CAF50;
            color: white;
        }

        .reject-btn {
            background-color: #f44336;
            color: white;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .navbar {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>

<body>
    <header>
        <nav class="navbar">
            <div class="logo">
                <a href="../pages/index.html">
                    <img src="../images/logo-placeholder.png" alt="Elderly Assistance Portal Logo">
                    <h1>Elderly Assistance Portal</h1>
                </a>
            </div>
            <div class="nav-links">
                <span>Welcome to your dashboard</span>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </nav>
    </header>
    <div class="welcome-banner">
        <h2>Welcome to Your Personal Dashboard</h2>
        <p>Manage your profile, request assistance, and keep track of your activities all in one place.</p>
    </div>

    <main class="dashboard-container">
        <section class="profile-section">
            <h2>Welcome, <span id="volunteerName">Volunteer</span></h2><br>
            <h3>T&C</h3><br>
            <!-- <p><strong>Skills:</strong> <span id="volunteerSkills">--</span></p>
            <p><strong>Location:</strong> <span id="volunteerLocation">--</span></p>
            <p><strong>Availability:</strong> <span id="volunteerAvailability">--</span></p>
            <p><strong>Payment Rate:</strong> <span id="volunteerPayment">--</span></p> -->
            <p>
                1. Accept the request only if you are compatible with the help needed, urgency, location, and budget per day.
            </p><br>
            <p>
                2. When rejecting a request, you must provide a reason to the portal(On call if made by Portal).
            </p><br>
            <p>
                3. After completing the service, you will receive payment through the portal. No cash transactions with the elder are allowed.
            </p><br>

        </section>

        <section class="task-section">
            <h3>Available Tasks</h3>
            <div id="taskList" class="task-list">No tasks available yet.</div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h4>About Us</h4>
                <p>Elderly Assistance Portal connects seniors with volunteers and services to improve quality of life and independence.</p>
            </div>
            <div class="footer-column">
                <h4>Quick Links</h4>
                <a href="#">Home</a>
                <a href="#">Services</a>
                <a href="#">FAQs</a>
                <a href="#">Contact Us</a>
                <a href="#">Privacy Policy</a>
            </div>
            <div class="footer-column">
                <h4>Contact</h4>
                <p><i class="fas fa-phone"></i> Helpline: 1-800-555-HELP</p>
                <p><i class="fas fa-envelope"></i> support@elderlyassistance.org</p>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 Elderly Assistance Portal. All rights reserved.</p>
        </div>
    </footer>

    <script>
       

// volunteer.html script

document.addEventListener('DOMContentLoaded', async () => {
    // Get Volunteer ID from localStorage after login
    const volunteerId = localStorage.getItem('userId');

    // Redirect to login if not authenticated
    if (!volunteerId) {
        alert('Unauthorized access. Redirecting to login.');
        window.location.href = '../pages/loginPage.html';
        return;
    }

    // Fetch Volunteer Data
    async function fetchVolunteerData() {
        try {
            const response = await fetch(`http://localhost:3000/api/users/${volunteerId}`);
            if (!response.ok) throw new Error('Failed to fetch volunteer data');

            const volunteerData = await response.json();
            document.getElementById('volunteerName').textContent = volunteerData.name;
            document.getElementById('volunteerSkills').textContent = volunteerData.skills || '--';
            document.getElementById('volunteerLocation').textContent = volunteerData.location || '--';
            document.getElementById('volunteerAvailability').textContent = volunteerData.availability || '--';
            document.getElementById('volunteerPayment').textContent = volunteerData.paymentRate || '--';
        } catch (error) {
            console.error('Error fetching volunteer data:', error);
        }
    }

    // Fetch Available Tasks (Only pending)
    async function fetchTasks() {
        try {
            const response = await fetch('http://localhost:3000/api/tasks/pending');
            if (!response.ok) throw new Error('Failed to fetch tasks');

            const tasks = await response.json();
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = tasks.length === 0
                ? 'No tasks available.'
                : tasks.map(task => `
                    <div class="task-card" id="task-${task._id}">
                        <p><strong>Help Needed:</strong> ${task.helpType}</p>
                        <p><strong>Urgency:</strong> ${task.urgency}</p>
                        <p><strong>Location:</strong> ${task.location}</p>
                        <p><strong>Budget Per Day(Rs):</strong> ${task.budget}</p>
                        <button class="accept-btn" onclick="acceptTask('${task._id}')">Accept</button>
                        <button class="reject-btn" onclick="rejectTask('${task._id}')">Reject</button>
                    </div>
                `).join('');
        } catch (error) {
            console.error('Error fetching tasks:', error);
        }
    }

    // Accept Task
    window.acceptTask = async (taskId) => {
        try {
            const response = await fetch(`http://localhost:3000/api/tasks/${taskId}/accept`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ volunteerId }),
            });

            if (!response.ok) throw new Error('Failed to accept task');
            alert('Task accepted successfully!');

            // Remove accepted task from UI
            document.getElementById(`task-${taskId}`).remove();
        } catch (error) {
            alert('Error accepting task.');
        }
    };

    // Reject Task
    window.rejectTask = async (taskId) => {
        try {
            const response = await fetch(`http://localhost:3000/api/tasks/${taskId}/reject`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ rejectionMessage: 'Task rejected by volunteer.' }),
            });

            if (!response.ok) throw new Error('Failed to reject task');
            alert('Task rejected successfully.');

            // Remove rejected task from UI
            document.getElementById(`task-${taskId}`).remove();
        } catch (error) {
            alert('Error rejecting task.');
        }
    };

    window.logout = () => {
        localStorage.removeItem('userId');
        window.location.href = '../pages/index.html';
    };

    await fetchVolunteerData();
    await fetchTasks();
});


    </script>
</body>

</html>
